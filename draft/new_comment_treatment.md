## 目的
コメントとノードの紐付けを維持しつつ、`key = value` 間に空の改行を挿入できるようにする。

## 背景
Tombi の自動ソートは「ノードとコメントの紐付けが安定すること」を前提にしている。
一方で、可読性のために空行によるグルーピングが求められている。
ここでは、**安定性 (idempotent)** と **コメントの紐付け** を維持したまま、
空行を「意味を持つ区切り」として扱う方針を検討する。

## 目標
- 空行をキー間の論理グループとして扱える
- 自動ソート後もコメントの紐付けが壊れない
- フォーマットの再実行で結果が変わらない (安定)

## 既存課題
- コメントは AST ノードに紐付くため、並び替えで関連が崩れる
- 空行は現在「情報を持たない whitespace」として捨てられる

## 提案: 空行を「境界ノード」として保持する

### 1. 空行を `Separator` として AST に埋め込む
- 連続する空行を `Separator(n)` として保持 (n は連続数)
- `Separator` はキーに紐付かず、**グループ境界**として扱う

### 2. ソートは「グループ単位」で実行
- `Separator` で分割された範囲をグループとみなし、各グループ内だけソート
- グループ間の順序は **元の順序を維持**
- コメントはグループ内のキーに紐付いたまま

### 3. グループ間移動を抑制するルール
自動ソートでキーが別グループに移動すると、
空行の意味 (視覚的区切り) が壊れるため禁止する。
結果として:
- `keyA` と `keyB` の順序を入れ替える必要がある場合、
  **同一グループ内**に存在していないと並び替えは実施しない
- これにより安定性を確保

### 4. コメントの紐付けはグループ内で維持
- コメントは既存のロジック通りノードに紐付ける
- `Separator` 自体にはコメントを紐付けない

## 仕様案

### フォーマット挙動
```
key1 = "a"
key3 = "c"

key2 = "b"
```
↓ (key1, key3 は同グループなのでソート対象)
```
key1 = "a"
key3 = "c"

key2 = "b"
```

### 例2: グループを跨ぐ移動は禁止
```
key1 = "a"

key2 = "b"
key3 = "c"
```
↓ (key2, key3 は同グループ内でソート)
```
key1 = "a"

key2 = "b"
key3 = "c"
```
`key1` と `key2` は別グループのため並び替えなし

## 代替案 (非推奨)

### A. 空行をコメントと同等に扱う
- コメント再配置と同様の問題が発生するため不適

### B. 空行の数を保持せず最大値だけ保持
- グループ意図が失われるため不可

## 実装上のポイント
- パーサで空行を `Separator` として保持する必要がある
- フォーマッタのソート関数に「グループ境界」を渡す
- 既存の comment attachment を壊さないよう、キーの移動はグループ内のみ

## 未解決の論点
- schema 側で定義されるソート順とグループ分割の整合
- 複合キー (inline table, array of tables) でのグループ判定
- 連続空行数の正規化 (最大 1 で良いか)
